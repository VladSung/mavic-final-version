M.mod_quiz=M.mod_quiz||{},M.mod_quiz.init_attempt_form=function(e){M.core_question_engine.init_form(e,"#responseform"),e.on("submit",M.mod_quiz.timer.stop,"#responseform"),M.core_formchangechecker.init({formid:"responseform"})},M.mod_quiz.init_review_form=function(e){M.core_question_engine.init_form(e,".questionflagsaveform"),e.on("submit",function(e){e.halt()},".questionflagsaveform")},M.mod_quiz.init_comment_popup=function(e){var t=e.Node.create('<input type="button" />');t.set("value",M.util.get_string("cancel","moodle")),e.one("#id_submitbutton").ancestor().append(t),e.on("click",function(){window.close()},t)},M.mod_quiz.timer={Y:null,endtime:0,preview:0,timeoutid:null,init:function(e,t,o){M.mod_quiz.timer.Y=e,M.mod_quiz.timer.endtime=M.pageloadstarttime.getTime()+1e3*t,M.mod_quiz.timer.preview=o,M.mod_quiz.timer.update(),e.one("#quiz-timer").setStyle("display","block")},stop:function(e){M.mod_quiz.timer.timeoutid&&clearTimeout(M.mod_quiz.timer.timeoutid)},two_digit:function(e){return e<10?"0"+e:e},update:function(){var e=M.mod_quiz.timer.Y,t=Math.floor(M.mod_quiz.timer.endtime/1e3),o=Math.floor(t/3600);t-=3600*o;var n=Math.floor(t/60),i=t-=60*n;e.one("#quiz-time-left").setContent(o+":"+M.mod_quiz.timer.two_digit(n)+":"+M.mod_quiz.timer.two_digit(i)),M.mod_quiz.timer.timeoutid=setTimeout(M.mod_quiz.timer.update,100)}},M.mod_quiz.nav=M.mod_quiz.nav||{},M.mod_quiz.nav.update_flag_state=function(e,t,o){var n=M.mod_quiz.nav.Y.one("#quiznavbutton"+t);n.removeClass("flagged"),1==o?(n.addClass("flagged"),n.one(".accesshide .flagstate").setContent(M.util.get_string("flagged","question"))):n.one(".accesshide .flagstate").setContent("")},M.mod_quiz.nav.init=function(e){M.mod_quiz.nav.Y=e,e.all("#quiznojswarning").remove();var t=e.one("#responseform");if(t){function o(o){e.one("#followingpage").set("value",o);var n=t.one('input[name="next"]');n.set("name",""),n.getDOMNode().click()}e.delegate("click",function(e){if(!this.hasClass("thispage")){e.preventDefault();var n,i=this.get("href").match(/page=(\d+)/);n=i?i[1]:0;var u=this.get("href").match(/#q(\d+)/);u&&t.set("action",t.get("action")+"#q"+u[1]),o(n)}},document.body,".qnbutton")}e.one("a.endtestlink")&&e.on("click",function(e){e.preventDefault(),o(-1)},"a.endtestlink"),M.core_question_flags&&M.core_question_flags.add_listener(M.mod_quiz.nav.update_flag_state)},M.mod_quiz.secure_window={init:function(e){"file"==window.location.href.substring(0,4)&&(window.location="about:blank"),e.delegate("contextmenu",M.mod_quiz.secure_window.prevent,document,"*"),e.delegate("mousedown",M.mod_quiz.secure_window.prevent_mouse,"body","*"),e.delegate("mouseup",M.mod_quiz.secure_window.prevent_mouse,"body","*"),e.delegate("dragstart",M.mod_quiz.secure_window.prevent,document,"*"),e.delegate("selectstart",M.mod_quiz.secure_window.prevent_selection,document,"*"),e.delegate("cut",M.mod_quiz.secure_window.prevent,document,"*"),e.delegate("copy",M.mod_quiz.secure_window.prevent,document,"*"),e.delegate("paste",M.mod_quiz.secure_window.prevent,document,"*"),e.on("beforeprint",function(){e.one(document.body).setStyle("display","none")},window),e.on("afterprint",function(){e.one(document.body).setStyle("display","block")},window),e.on("key",M.mod_quiz.secure_window.prevent,"*","press:67,86,88+ctrl"),e.on("key",M.mod_quiz.secure_window.prevent,"*","up:67,86,88+ctrl"),e.on("key",M.mod_quiz.secure_window.prevent,"*","down:67,86,88+ctrl"),e.on("key",M.mod_quiz.secure_window.prevent,"*","press:67,86,88+meta"),e.on("key",M.mod_quiz.secure_window.prevent,"*","up:67,86,88+meta"),e.on("key",M.mod_quiz.secure_window.prevent,"*","down:67,86,88+meta")},is_content_editable:function(e){return!!e.test("[contenteditable=true]")||null!==(e=e.get("parentNode"))&&M.mod_quiz.secure_window.is_content_editable(e)},prevent_selection:function(e){return!1},prevent:function(e){alert(M.util.get_string("functiondisabledbysecuremode","quiz")),e.halt()},prevent_mouse:function(e){1==e.button&&/^(INPUT|TEXTAREA|BUTTON|SELECT|LABEL|A)$/i.test(e.target.get("tagName"))||1==e.button&&M.mod_quiz.secure_window.is_content_editable(e.target)||e.halt()},init_close_button:function(e,t){e.on("click",function(e){M.mod_quiz.secure_window.close(t,0)},"#secureclosebutton")},close:function(e,t,o){setTimeout(function(){window.opener?(window.opener.document.location.reload(),window.close()):window.location.href=t},1e3*o)}};
